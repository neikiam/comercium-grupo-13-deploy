{% extends "base.html" %}
{% load static %}
{% block title %}Inicio â€¢ Centro de Comercio Digital{% endblock %}

{% block content %}
<section class="hero-retro">
  <div class="container">
    <h1>Bienvenido a tu mercado local favorito</h1>
    <p>El mercado es tuyo</p>
    <a href="{% url 'mercado:productlist' %}" class="btn-retro">Ver productos</a>
  </div>
</section>

<div class="container" style="margin-top: 2rem; margin-bottom: 2rem;">
    <h2 style="margin-bottom: 1.5rem;">Ãšltimos productos</h2>
    <div class="grid-retro">
        {% for p in products %}
            <div class="card-retro">
                {% if p.image %}
                    <div class="thumb-box-200">
                        <img src="{{ p.image.url }}" alt="{{ p.title }}" loading="lazy">
                    </div>
                {% endif %}
                <div style="padding: 1rem;">
                    {% if not p.is_available %}
                        <span style="display:inline-block; background: #f44336; color: #fff; padding: 0.2rem 0.5rem; border-radius: 6px; font-size: 0.8rem; margin-bottom: 0.5rem;">Sin stock</span>
                    {% endif %}
                    <h3 style="margin: 0.5rem 0; font-size: 1.1rem; text-align: center;">
                        <a href="{% url 'mercado:product-detail' p.id %}" style="color: inherit; text-decoration: none;">
                            {{ p.title }}
                        </a>
                    </h3>
                    <p style="font-size: 1.1rem; font-weight: bold; color: var(--retro-accent); text-align: center; margin: 0.75rem 0;">${{ p.price }}</p>
                    
                    {% if user.is_authenticated %}
                        {% if p.is_available and user != p.seller %}
                            <form method="post" action="{% url 'mercado:add-to-cart' p.id %}">
                                {% csrf_token %}
                                <button type="submit" class="btn-retro btn-small" style="width: 100%; text-align: center; display: block;">ðŸ›’ Agregar al carrito</button>
                            </form>
                        {% elif not p.is_available %}
                            <button class="btn-retro-secondary btn-small" style="width: 100%; text-align: center; display: block; opacity: 0.7; cursor: not-allowed;" disabled>Sin stock</button>
                        {% endif %}
                    {% else %}
                        <a href="{% url 'account_login' %}" class="btn-retro-secondary btn-small" style="width: 100%; text-align: center; display: block;">Inicia sesiÃ³n para comprar</a>
                    {% endif %}
                </div>
            </div>
        {% empty %}
            <p style="color: #666;">No hay productos disponibles todavÃ­a.</p>
        {% endfor %}
    </div>
</div>

{% endblock %}
